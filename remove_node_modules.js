const util = require( 'util' )
const fs = require('fs')
const readDir = util.promisify( fs.readdir )
const path = require( "path" )

async function getDirectories( directoryPath ) {
    let filesAndDirectories = await readDir( directoryPath )

    let directories = [];
    await Promise.all(
        filesAndDirectories.map(name => {
          let stats = fs.statSync( path.join( directoryPath + name ) )
          if(stats.isDirectory()) directories.push(name)
        })
    );
    return directories;
}

let removeNodeModules = ( async ( sourcFolder, destinationFolder, selectedDirectories ) => {
  let directories = await getDirectories( sourcFolder )

  await Promise.all( 
    directories.map( directory => {
      if( selectedDirectories.includes( directory ) ) {
        fs.renameSync( path.join( sourcFolder, directory ), path.join( destinationFolder, directory ) )
      }
    })
  )

  fs.rmdirSync( sourcFolder, { recursive: true } )
})()

module.exports = {
  removeNodeModules: removeNodeModules
}